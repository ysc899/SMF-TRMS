--  Generate SQL 
--  Version:                   V7R4M0 190621 
--  Generated on:              22/12/09 13:18:20 
--  Relational Database:       NEODIN 
--  Standards Option:          Db2 for i 
--DROP SPECIFIC PROCEDURE IF EXISTS MCLISOLIB.SEL02_DAYLABTCDCOUNT_MC111D_SP ; 
--SET PATH "QSYS","QSYS2","SYSPROC","SYSIBMADM","NEO030" ; 
CREATE OR REPLACE PROCEDURE MCLISOLIB.SEL02_DAYLABTCDCOUNT_MC111D_SP ( 
  IN $P_COR VARCHAR(3) , 
  IN $P_DAT VARCHAR(8) ) 
  DYNAMIC RESULT SETS 1 
  LANGUAGE SQL 
  SPECIFIC MCLISOLIB.SEL02_DAYLABTCDCOUNT_MC111D_SP 
  NOT DETERMINISTIC 
  MODIFIES SQL DATA 
  CALLED ON NULL INPUT 
  SET OPTION  ALWBLK = *ALLREAD , 
  ALWCPYDTA = *OPTIMIZE , 
  COMMIT = *CHG , 
  DBGVIEW = *SOURCE , 
  DECRESULT = (31, 31, 00) , 
  DFTRDBCOL = *NONE , 
  DLYPRP = *NO , 
  DYNDFTCOL = *NO , 
  DYNUSRPRF = *USER , 
  SRTSEQ = *HEX 
  BEGIN 
DECLARE CUR CURSOR FOR 
SELECT CASE WHEN $P_DAT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN '당일' ELSE '전일' END AS DATE_VAL , 'Serum' AS TCD , IFNULL ( TCNT , 0 ) AS TCNT , IFNULL ( SCNT , 0 ) AS SCNT , IFNULL ( BCNT , 0 ) AS BCNT , IFNULL ( DCNT , 0 ) AS DCNT , IFNULL ( GCNT , 0 ) AS GCNT , IFNULL ( JCNT , 0 ) AS JCNT 
FROM ( 
SELECT 
( SELECT COUNT ( * ) FROM MCLISDLIB . MC111D06 WHERE F111COR = $P_COR AND F111DAT = $P_DAT AND F111TCD = 'A01' ) TCNT ,  ----전체건수 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ----서울건수 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ----부산건수 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ----대구건수 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ----광주건수 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ----대전건수 
FROM ( 
SELECT F600DAT , F600JNO , F600CNO 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111D06 
ON F111COR = F600COR 
AND F111DAT = F600DAT 
AND F111JNO = F600JNO 
AND F111TCD = 'A01' 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = $P_DAT AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F999CD3 IS NULL 
GROUP BY F600DAT , F600JNO , F600CNO 
) 
) 
UNION ALL 
SELECT CASE WHEN $P_DAT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN '당일' ELSE '전일' END AS DATE_VAL , 'EDTA' AS TCD , IFNULL ( TCNT , 0 ) , IFNULL ( SCNT , 0 ) , IFNULL ( BCNT , 0 ) , IFNULL ( DCNT , 0 ) , IFNULL ( GCNT , 0 ) , IFNULL ( JCNT , 0 ) 
FROM ( 
SELECT 
( SELECT COUNT ( * ) FROM MCLISDLIB . MC111D06 WHERE F111COR = $P_COR AND F111DAT = $P_DAT AND F111TCD = 'A05' ) TCNT ,  ----전체건수 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ----서울건수 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ----부산건수 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ----대구건수 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ----광주건수 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ----대전건수 
FROM ( 
SELECT F600DAT , F600JNO , F600CNO 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111D06 
ON F111COR = F600COR 
AND F111DAT = F600DAT 
AND F111JNO = F600JNO 
AND F111TCD = 'A05' 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = $P_DAT AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F999CD3 IS NULL 
GROUP BY F600DAT , F600JNO , F600CNO 
) 
) 
UNION ALL 
SELECT CASE WHEN $P_DAT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN '당일' ELSE '전일' END AS DATE_VAL , 'Urine' AS TCD , IFNULL ( TCNT , 0 ) , IFNULL ( SCNT , 0 ) , IFNULL ( BCNT , 0 ) , IFNULL ( DCNT , 0 ) , IFNULL ( GCNT , 0 ) , IFNULL ( JCNT , 0 ) 
FROM ( 
SELECT 
( SELECT COUNT ( * ) FROM MCLISDLIB . MC111D06 WHERE F111COR = $P_COR AND F111DAT = $P_DAT AND F111TCD = 'U01' ) TCNT ,  ----전체건수 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ----서울건수 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ----부산건수 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ----대구건수 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ----광주건수 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ----대전건수 
FROM ( 
SELECT F600DAT , F600JNO , F600CNO 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111D06 
ON F111COR = F600COR 
AND F111DAT = F600DAT 
AND F111JNO = F600JNO 
AND F111TCD = 'U01' 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = $P_DAT AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F999CD3 IS NULL 
GROUP BY F600DAT , F600JNO , F600CNO 
) 
) 
UNION ALL 
SELECT CASE WHEN $P_DAT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN '당일' ELSE '전일' END AS DATE_VAL , 'Plasma' AS TCD , IFNULL ( TCNT , 0 ) , IFNULL ( SCNT , 0 ) , IFNULL ( BCNT , 0 ) , IFNULL ( DCNT , 0 ) , IFNULL ( GCNT , 0 ) , IFNULL ( JCNT , 0 ) 
FROM ( 
SELECT 
( SELECT COUNT ( * ) FROM MCLISDLIB . MC111D06 WHERE F111COR = $P_COR AND F111DAT = $P_DAT AND ( F111TCD = 'C12' OR F111TCD = 'A02' ) ) TCNT ,  ----전체건수 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ----서울건수 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ----부산건수 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ----대구건수 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ----광주건수 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ----대전건수 
FROM ( 
SELECT F600DAT , F600JNO , F600CNO 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111D06 
ON F111COR = F600COR 
AND F111DAT = F600DAT 
AND F111JNO = F600JNO 
AND ( F111TCD = 'C12' OR F111TCD = 'A02' ) 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = $P_DAT AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F999CD3 IS NULL 
GROUP BY F600DAT , F600JNO , F600CNO 
) 
) 
UNION ALL 
SELECT CASE WHEN $P_DAT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN '당일' ELSE '전일' END AS DATE_VAL , 'Other' AS TCD , IFNULL ( TCNT , 0 ) , IFNULL ( SCNT , 0 ) , IFNULL ( BCNT , 0 ) , IFNULL ( DCNT , 0 ) , IFNULL ( GCNT , 0 ) , IFNULL ( JCNT , 0 ) 
FROM ( 
SELECT 
( SELECT COUNT ( * ) FROM MCLISDLIB . MC111D06 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F111COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F111GCD WHERE F111COR = $P_COR AND F111DAT = $P_DAT AND F111TCD NOT IN ( 'A01' , 'A05' , 'U01' , 'C12' , 'A02' ) AND F999CD3 IS NULL ) TCNT ,  ----전체건수 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ----서울건수 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ----부산건수 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ----대구건수 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ----광주건수 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ----대전건수 
FROM ( 
SELECT F600DAT , F600JNO , F600CNO 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111D06 
ON F111COR = F600COR 
AND F111DAT = F600DAT 
AND F111JNO = F600JNO 
AND F111TCD NOT IN ( 'A01' , 'A05' , 'U01' , 'C12' , 'A02' ) 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = $P_DAT AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F999CD3 IS NULL 
GROUP BY F600DAT , F600JNO , F600CNO 
) 
) ; 
OPEN CUR ; 
SET RESULT SETS CURSOR CUR ; 
END  ; 
