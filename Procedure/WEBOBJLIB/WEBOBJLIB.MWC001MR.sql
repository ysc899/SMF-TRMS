DROP PROCEDURE WEBOBJLIB.MWC001MR;

CREATE PROCEDURE WEBOBJLIB.MWC001MR
(
	  IN I_COR 		VARCHAR(3) 		-- COR
	, IN I_UID 		VARCHAR(12) 	-- 사용자 ID
	, IN I_IP		VARCHAR(30)		-- 로그인 IP
	, OUT O_MSGCOD	VARCHAR(3)		-- 메세지 코드
	, OUT O_ERRCOD	VARCHAR(10)		-- 에러 코드
	, IN I_HOS		VARCHAR(10)		-- 병원 코드
	, IN I_CHN		VARCHAR(15)		-- 차트번호
	, IN I_NAM		VARCHAR(100)	-- 수진자명
	, IN I_SEX		VARCHAR(20)		-- 성별
)
LANGUAGE SQL
DYNAMIC RESULT SETS 1
BEGIN
	-- 수진자 정보 관리, LIST 조회
	DECLARE CUR1  CURSOR WITH RETURN FOR  
	
	SELECT
		 TRIM(C001HOS) AS C001HOS		-- 병원 코드
		,TRIM(C001CHN) AS C001CHN		-- 차트 번호
		,TRIM(C001NAM) AS C001NAM		-- 수진자 명
		,TRIM(C001HPN) AS C001HPN		-- 핸드폰 번호
		,TRIM(C001BDT) AS C001BDT		-- 생년월일
		,TRIM(C001SEX) AS C001SEX		-- 성별
		,TRIM(C001AGE) AS C001AGE		-- 나이
		,TRIM(C001CUR) AS C001CUR		-- 등록자 ID
		,TRIM(C001CDT) AS C001CDT		-- 등록 일자
		,TRIM(C001CTM) AS C001CTM		-- 등록 시간
		,TRIM(C001CIP) AS C001CIP		-- 등록자 IP
		,TRIM(C001UUR) AS C001UUR		-- 수정자 ID
		,TRIM(C001UDT) AS C001UDT		-- 수정 일자
		,TRIM(C001UTM) AS C001UTM		-- 수정 시간
		,TRIM(C001UIP) AS C001UIP		-- 수정자 IP
	FROM
		WEBDBLIB.MWC001M@
	WHERE   C001COR = I_COR
		AND C001HOS = I_HOS
		AND	C001CHN LIKE I_CHN || '%'
		AND C001NAM LIKE I_NAM || '%'
		AND C001SEX LIKE '%' || I_SEX || '%'
	ORDER BY C001CDT DESC, C001CTM DESC;
		
	OPEN CUR1;
	
	SET O_MSGCOD = '200';
	SET O_ERRCOD = '';

END