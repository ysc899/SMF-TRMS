DROP PROCEDURE WEBOBJLIB.MWC002MR;

CREATE PROCEDURE WEBOBJLIB.MWC002MR
(
	  IN I_COR 		VARCHAR(3) 		-- COR
	, IN I_UID 		VARCHAR(12) 	-- 사용자 ID
	, IN I_IP		VARCHAR(30)		-- 로그인 IP
	, OUT O_MSGCOD	VARCHAR(3)		-- 메세지 코드
	, OUT O_ERRCOD	VARCHAR(10)		-- 에러 코드
	, IN I_HOS		VARCHAR(5)		-- 병원 코드
	, IN I_NAM		VARCHAR(100)	-- 메시지명
)
LANGUAGE SQL
DYNAMIC RESULT SETS 1
BEGIN
	-- SMS 메시지 관리, 메세지 정보 LIST 호출
	DECLARE CUR1  CURSOR WITH RETURN FOR  	
	SELECT
		 TRIM(C002COR) AS C002COR		-- 회사코드
		,TRIM(C002HOS) AS C002HOS		-- 병원코드
		,TRIM(C002SEQ) AS C002SEQ		-- 메시지순번
		,TRIM(C002NAM) AS C002NAM		-- 메시지 명
		,TRIM(C002MSG) AS C002MSG		-- 메시지
		,TRIM(C002DYN) AS C002DYN		-- 삭제 여부
		,TRIM(C002CUR) AS C002CUR		-- 등록자 ID
		,TRIM(C002CDT) AS C002CDT		-- 등록 일자
		,TRIM(C002CTM) AS C002CTM		-- 등록 시간
		,TRIM(C002CIP) AS C002CIP		-- 등록자 IP
		,TRIM(C002UUR) AS C002UUR		-- 수정자 ID
		,TRIM(C002UDT) AS C002UDT		-- 수정 일자
		,TRIM(C002UTM) AS C002UTM		-- 수정 시간
		,TRIM(C002UIP) AS C002UIP		-- 수정자 IP
		,TRIM(C002DUR) AS C002DUR		-- 삭제자 ID
		,TRIM(C002DDT) AS C002DDT 		-- 삭제 일자
		,TRIM(C002DTM) AS C002DTM		-- 삭제 시간
		,TRIM(C002DIP) AS C002DIP		-- 삭제자 IP
	FROM
		WEBDBLIB.MWC002M@
	WHERE C002COR = I_COR
  	  AND C002HOS = I_HOS
	  AND C002DYN = 'N'  
	  AND C002NAM LIKE I_NAM || '%'
	 ORDER BY C002CDT DESC, C002CTM DESC;
	
	OPEN CUR1;
	
	SET O_MSGCOD = '200';
	SET O_ERRCOD = '';

END