DROP PROCEDURE WEBOBJLIB.MWR001A2

CREATE OR REPLACE PROCEDURE WEBOBJLIB.MWR001A1 (IN I_COR VARCHAR(3)
									  , IN I_UID VARCHAR(12)
									  , IN I_IP  VARCHAR(30)
									  , OUT O_MSGCOD VARCHAR(3)
									  , OUT O_ERRCOD VARCHAR(10)
									  , IN I_DAT  DECIMAL(8,0)
									  , IN I_JNO  DECIMAL(5,0)
									  , IN I_HOS  VARCHAR(5))
LANGUAGE SQL
DYNAMIC RESULT SETS 1
BEGIN
	-- 추가검사의뢰리스트를 별도로 관리한다.
	IF I_HOS = '12527' THEN
     	 -- 별도로 관리되는 병원별 추가검사의뢰리스트
      	BEGIN
			--추가 의뢰서
			DECLARE C1 CURSOR WITH RETURN FOR 
			SELECT
				R001COR AS COR
				, R001GCD AS GCD
				, R001XSQ AS X
				, R001YSQ AS Y
				, R001GNM AS G_NAME
				, R001OCD AS O_CD
				, R001TCD AS S_CD
				, (  SELECT 
					  F999NM2
					FROM MCLISDLIB.MC999D@ MC9 
					WHERE  F999COR = 'NML' 
					AND F999CD1='CLIC' 
					AND F999CD2 = 'SAMP' 
					AND F999CD3 = R001TCD ) AS S_NAME
				, IFNULL ( ( SELECT 1
					FROM MCLISDLIB."MC110H@" CHK1
					WHERE CHK1 . F110GCD = A.R001GCD
					AND (CHK1.F110COR = I_COR )
					AND (CHK1.F110DAT = I_DAT )
					AND (CHK1.F110JNO = I_JNO ) ) , 0 ) CHK1
				, IFNULL ( ( SELECT 1
					FROM WEBDBLIB.MWR001D@  CHK2
					WHERE CHK2.R001GCD = A.R001GCD
					AND ( CHK2.R001COR = I_COR )
					AND ( CHK2.R001DAT = I_DAT )
					AND ( CHK2.R001JNO = I_JNO ) ) , 0 ) CHK2
				, ( SELECT F010STS
					FROM MCLISDLIB."MC010M@" CHK3
					WHERE CHK3 . F010GCD = A.R001GCD
					AND (CHK3.F010COR = I_COR ) ) CHK3
			FROM WEBDBLIB.MWR001C@ A
			WHERE R001HOS = I_HOS
			ORDER BY R001XSQ, R001YSQ;
			SET O_ERRCOD = '';
			SET O_MSGCOD = 200;
			OPEN C1;
		END;
	ELSE
		BEGIN
			--추가 의뢰서
			DECLARE C2 CURSOR WITH RETURN FOR 
			SELECT
				R001COR AS COR
				, R001GCD AS GCD
				, R001XSQ AS X
				, R001YSQ AS Y
				, R001GNM AS G_NAME
				, R001OCD AS O_CD
				, R001TCD AS S_CD
				, (  SELECT 
					  F999NM2
					FROM MCLISDLIB.MC999D@ MC9 
					WHERE  F999COR = 'NML' 
					AND F999CD1='CLIC' 
					AND F999CD2 = 'SAMP' 
					AND F999CD3 = R001TCD ) AS S_NAME
				, IFNULL ( ( SELECT 1
					FROM MCLISDLIB."MC110H@" CHK1
					WHERE CHK1 . F110GCD = A.R001GCD
					AND (CHK1.F110COR = I_COR )
					AND (CHK1.F110DAT = I_DAT )
					AND (CHK1.F110JNO = I_JNO ) ) , 0 ) CHK1
				, IFNULL ( ( SELECT 1
					FROM WEBDBLIB.MWR001D@  CHK2
					WHERE CHK2.R001GCD = A.R001GCD
					AND ( CHK2.R001COR = I_COR )
					AND ( CHK2.R001DAT = I_DAT )
					AND ( CHK2.R001JNO = I_JNO ) ) , 0 ) CHK2
				, ( SELECT F010STS
					FROM MCLISDLIB."MC010M@" CHK3
					WHERE CHK3 . F010GCD = A.R001GCD
					AND (CHK3.F010COR = I_COR ) ) CHK3
			FROM WEBDBLIB.MWR001C@ A
			WHERE R001HOS = ''
			ORDER BY R001XSQ, R001YSQ;
			SET O_ERRCOD = '';
			SET O_MSGCOD = 200;
			OPEN C2;
		END;
   END IF;
END