DROP PROCEDURE WEBOBJLIB.MWC003DR;

CREATE PROCEDURE WEBOBJLIB.MWC003DR
(
	  IN I_COR 		VARCHAR(3) 		-- COR
	, IN I_UID 		VARCHAR(12) 	-- 사용자 ID
	, IN I_IP		VARCHAR(30)		-- 로그인 IP
	, OUT O_MSGCOD	VARCHAR(3)		-- 메세지 코드
	, OUT O_ERRCOD	VARCHAR(10)		-- 에러 코드
	, IN I_HOS		VARCHAR(5)		-- 병원 코드					
	, IN I_SEQ		DECIMAL(10, 0)	-- 메시지 순번
)
LANGUAGE SQL
DYNAMIC RESULT SETS 1
BEGIN
	-- SMS 연동 관리, 수진자 정보 LIST 호출
	DECLARE CUR1  CURSOR WITH RETURN FOR  	
	SELECT
		 TRIM(C001HOS) AS C001HOS		-- 병원 코드
		,TRIM(C001CHN) AS C001CHN		-- 차트 번호
		,TRIM(C001NAM) AS C001NAM		-- 수진자 명
		,TRIM(C001HPN) AS C001HPN		-- 핸드폰 번호
		,TRIM(C001BDT) AS C001BDT		-- 생년월일
		,TRIM(C001SEX) AS C001SEX		-- 성별
		,TRIM(C001AGE) AS C001AGE		-- 나이
		,TRIM(C003SEQ) AS C003SEQ		-- 메시지 순번
		,TRIM(C001CUR) AS C001CUR		-- 등록자 ID
		,TRIM(C001CDT) AS C001CDT		-- 등록 일자
		,TRIM(C001CTM) AS C001CTM		-- 등록 시간
		,TRIM(C001CIP) AS C001CIP		-- 등록자 IP
	FROM
		WEBDBLIB.MWC003D@ MWC003D
	 RIGHT JOIN WEBDBLIB.MWC001M@ MWC001M ON C003CHN = C001CHN
	WHERE 
			C003COR = I_COR
		AND C003SEQ = I_SEQ
		AND C003HOS = I_HOS;
	
	OPEN CUR1;
	
	SET O_MSGCOD = '200';
	SET O_ERRCOD = '';

END