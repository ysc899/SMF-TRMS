--  Generate SQL 
--  Version:                   V7R4M0 190621 
--  Generated on:              22/12/09 13:17:56 
--  Relational Database:       NEODIN 
--  Standards Option:          Db2 for i 
--DROP SPECIFIC PROCEDURE IF EXISTS MCLISOLIB.SEL02_DAYNIGHTWORKINGRATE_MC615M_SP ; 
--SET PATH "QSYS","QSYS2","SYSPROC","SYSIBMADM","NEO014" ; 
CREATE OR REPLACE PROCEDURE MCLISOLIB.SEL02_DAYNIGHTWORKINGRATE_MC615M_SP ( 
  IN $P_COR VARCHAR(3) , 
  IN $P_DAT VARCHAR(8) ) 
  DYNAMIC RESULT SETS 1 
  LANGUAGE SQL 
  SPECIFIC MCLISOLIB.SEL02_DAYNIGHTWORKINGRATE_MC615M_SP 
  NOT DETERMINISTIC 
  MODIFIES SQL DATA 
  CALLED ON NULL INPUT 
  SET OPTION  ALWBLK = *ALLREAD , 
  ALWCPYDTA = *OPTIMIZE , 
  COMMIT = *CHG , 
  DBGVIEW = *SOURCE , 
  DECRESULT = (31, 31, 00) , 
  DFTRDBCOL = *NONE , 
  DLYPRP = *NO , 
  DYNDFTCOL = *NO , 
  DYNUSRPRF = *USER , 
  SRTSEQ = *HEX 
  BEGIN 
DECLARE CUR CURSOR FOR 
SELECT '야간' , '전체인원' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F999CD31 = '0000' THEN DECIMAL ( F999NM2 , 2 , 0 ) ELSE 0 END ) 
SCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6526' THEN DECIMAL ( F999NM2 , 2 , 0 ) ELSE 0 END ) 
BCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6520' THEN DECIMAL ( F999NM2 , 2 , 0 ) ELSE 0 END ) 
DCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6540' THEN DECIMAL ( F999NM2 , 2 , 0 ) ELSE 0 END ) 
GCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6550' THEN DECIMAL ( F999NM2 , 2 , 0 ) ELSE 0 END ) 
JCNT  ---- 
FROM MCLISDLIB . MC999D07 
WHERE F999COR = $P_COR AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' 
) 
UNION ALL 
SELECT '야간' , '근무인원' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F615LMB = '0000' THEN F615CNT ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6526' THEN F615CNT ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6520' THEN F615CNT ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6540' THEN F615CNT ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6550' THEN F615CNT ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC615M@ 
WHERE F615COR = $P_COR AND F615DAT = $P_DAT AND F615DNC = 'N' 
) 
UNION ALL 
SELECT '야간' , '근무율' 
, CASE WHEN ( 100.00 * SCNT2 / SCNT ) = 0 OR SCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * SCNT2 / SCNT , 5 , 2 ) , 0 ) || '%' END AS SCNT 
, CASE WHEN ( 100.00 * BCNT2 / BCNT ) = 0 OR BCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * BCNT2 / BCNT , 5 , 2 ) , 0 ) || '%' END AS BCNT 
, CASE WHEN ( 100.00 * DCNT2 / DCNT ) = 0 OR DCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * DCNT2 / DCNT , 5 , 2 ) , 0 ) || '%' END AS DCNT 
, CASE WHEN ( 100.00 * GCNT2 / GCNT ) = 0 OR GCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * GCNT2 / GCNT , 5 , 2 ) , 0 ) || '%' END AS GCNT 
, CASE WHEN ( 100.00 * JCNT2 / JCNT ) = 0 OR JCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * JCNT2 / JCNT , 5 , 2 ) , 0 ) || '%' END AS JCNT 
FROM ( 
SELECT 
( SELECT SUM ( DECIMAL ( F999NM2 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '0000' AND F999CD32 NOT IN ( '0101' , '0102' ) ) SCNT ,  ---- 
( SELECT SUM ( DECIMAL ( F999NM2 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '6526' AND F999CD32 NOT IN ( '0101' , '0102' ) ) BCNT ,  ---- 
( SELECT SUM ( DECIMAL ( F999NM2 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '6520' AND F999CD32 NOT IN ( '0101' , '0102' ) ) DCNT ,  ---- 
( SELECT SUM ( DECIMAL ( F999NM2 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '6540' AND F999CD32 NOT IN ( '0101' , '0102' ) ) GCNT ,  ---- 
( SELECT SUM ( DECIMAL ( F999NM2 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '6550' AND F999CD32 NOT IN ( '0101' , '0102' ) ) JCNT ,  ---- 
IFNULL ( SUM ( CASE WHEN F615LMB = '0000' THEN F615CNT ELSE 0 END ) , 0 ) SCNT2 
,  ---- 
IFNULL ( SUM ( CASE WHEN F615LMB = '6526' THEN F615CNT ELSE 0 END ) , 0 ) BCNT2 
,  ---- 
IFNULL ( SUM ( CASE WHEN F615LMB = '6520' THEN F615CNT ELSE 0 END ) , 0 ) DCNT2 
,  ---- 
IFNULL ( SUM ( CASE WHEN F615LMB = '6540' THEN F615CNT ELSE 0 END ) , 0 ) GCNT2 
---- 
, 
IFNULL ( SUM ( CASE WHEN F615LMB = '6550' THEN F615CNT ELSE 0 END ) , 0 ) JCNT2 
FROM MCLISDLIB . MC615M@ 
WHERE F615COR = $P_COR AND F615DAT = $P_DAT AND F615DNC = 'N' 
) 
UNION ALL 
SELECT '주간' , '전체인원' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F999CD31 = '0000' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
SCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6526' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
BCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6520' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
DCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6540' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
GCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6550' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
JCNT  ---- 
FROM MCLISDLIB . MC999D07 
WHERE F999COR = $P_COR AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD32 NOT IN ( '0101' , '0102' ) 
) 
UNION ALL 
SELECT '주간' , '근무인원' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F615LMB = '0000' THEN F615CNT ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6526' THEN F615CNT ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6520' THEN F615CNT ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6540' THEN F615CNT ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6550' THEN F615CNT ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC615M@ 
WHERE F615COR = $P_COR AND F615DAT = $P_DAT AND F615DNC = 'D' AND F615HAK NOT IN ( '0101' , '0102' ) 
) 
UNION ALL 
SELECT '주간' , '근무율' 
, CASE WHEN ( 100.00 * SCNT2 / SCNT ) = 0 OR SCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * SCNT2 / SCNT , 5 , 2 ) , 0 ) || '%' END AS SCNT 
, CASE WHEN ( 100.00 * BCNT2 / BCNT ) = 0 OR BCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * BCNT2 / BCNT , 5 , 2 ) , 0 ) || '%' END AS BCNT 
, CASE WHEN ( 100.00 * DCNT2 / DCNT ) = 0 OR DCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * DCNT2 / DCNT , 5 , 2 ) , 0 ) || '%' END AS DCNT 
, CASE WHEN ( 100.00 * GCNT2 / GCNT ) = 0 OR GCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * GCNT2 / GCNT , 5 , 2 ) , 0 ) || '%' END AS GCNT 
, CASE WHEN ( 100.00 * JCNT2 / JCNT ) = 0 OR JCNT = 0 THEN '0.00%' ELSE IFNULL ( DECIMAL ( 100.00 * JCNT2 / JCNT , 5 , 2 ) , 0 ) || '%' END AS JCNT 
FROM ( 
SELECT 
( SELECT SUM ( DECIMAL ( F999NM1 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '0000' AND F999CD32 NOT IN ( '0101' , '0102' ) ) SCNT ,  ---- 
( SELECT SUM ( DECIMAL ( F999NM1 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '6526' AND F999CD32 NOT IN ( '0101' , '0102' ) ) BCNT ,  ---- 
( SELECT SUM ( DECIMAL ( F999NM1 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '6520' AND F999CD32 NOT IN ( '0101' , '0102' ) ) DCNT ,  ---- 
( SELECT SUM ( DECIMAL ( F999NM1 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '6540' AND F999CD32 NOT IN ( '0101' , '0102' ) ) GCNT ,  ---- 
( SELECT SUM ( DECIMAL ( F999NM1 , 3 , 0 ) ) FROM MCLISDLIB . MC999D05 WHERE F999COR = 'NML' AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD31 = '6550' AND F999CD32 NOT IN ( '0101' , '0102' ) ) JCNT ,  ---- 
IFNULL ( SUM ( CASE WHEN F615LMB = '0000' THEN F615CNT ELSE 0 END ) , 0 ) SCNT2 
,  ---- 
IFNULL ( SUM ( CASE WHEN F615LMB = '6526' THEN F615CNT ELSE 0 END ) , 0 ) BCNT2 
,  ---- 
IFNULL ( SUM ( CASE WHEN F615LMB = '6520' THEN F615CNT ELSE 0 END ) , 0 ) DCNT2 
,  ---- 
IFNULL ( SUM ( CASE WHEN F615LMB = '6540' THEN F615CNT ELSE 0 END ) , 0 ) GCNT2 
---- 
, 
IFNULL ( SUM ( CASE WHEN F615LMB = '6550' THEN F615CNT ELSE 0 END ) , 0 ) JCNT2 
FROM MCLISDLIB . MC615M@ 
WHERE F615COR = $P_COR AND F615DAT = $P_DAT AND F615DNC = 'D' AND F615HAK NOT IN ( '0101' , '0102' ) 
) 
UNION ALL 
SELECT '진검전문의' , '전체인원' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F999CD31 = '0000' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
SCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6526' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
BCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6520' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
DCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6540' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
GCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6550' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
JCNT  ---- 
FROM MCLISDLIB . MC999D07 
WHERE F999COR = $P_COR AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD32 = '0101' 
) 
UNION ALL 
SELECT '진검전문의' , '근무인원' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F615LMB = '0000' THEN F615CNT ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6526' THEN F615CNT ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6520' THEN F615CNT ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6540' THEN F615CNT ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6550' THEN F615CNT ELSE 0 END ) JCNT 
FROM MCLISDLIB . MC615M@ 
WHERE F615COR = $P_COR AND F615DAT = $P_DAT AND F615DNC = 'D' AND F615HAK = '0101' 
) 
UNION ALL 
SELECT '병리전문의' , '전체인원' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F999CD31 = '0000' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
SCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6526' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
BCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6520' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
DCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6540' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
GCNT ,  ---- 
SUM ( CASE WHEN F999CD31 = '6550' THEN DECIMAL ( F999NM1 , 2 , 0 ) ELSE 0 END ) 
JCNT  ---- 
FROM MCLISDLIB . MC999D07 
WHERE F999COR = $P_COR AND F999CD1 = 'INSA' AND F999CD2 = 'INSL' AND F999CD32 = 
'0102' 
) 
UNION ALL 
SELECT '병리전문의' , '근무인원' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F615LMB = '0000' THEN F615CNT ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6526' THEN F615CNT ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6520' THEN F615CNT ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6540' THEN F615CNT ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F615LMB = '6550' THEN F615CNT ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC615M@ 
WHERE F615COR = $P_COR AND F615DAT = $P_DAT AND F615DNC = 'D' AND F615HAK = '0102' 
) ; 
OPEN CUR ; 
SET RESULT SETS CURSOR CUR ; 
END  ; 
