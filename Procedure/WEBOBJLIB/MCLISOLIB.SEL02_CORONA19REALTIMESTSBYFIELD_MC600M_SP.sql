--  Generate SQL 
--  Version:                   V7R4M0 190621 
--  Generated on:              22/12/09 13:15:53 
--  Relational Database:       NEODIN 
--  Standards Option:          Db2 for i 
--DROP SPECIFIC PROCEDURE IF EXISTS MCLISOLIB.SEL02_CORONA19REALTIMESTSBYFIELD_MC600M_SP ; 
--SET PATH "QSYS","QSYS2","SYSPROC","SYSIBMADM","NEO030" ; 
CREATE OR REPLACE PROCEDURE MCLISOLIB.SEL02_CORONA19REALTIMESTSBYFIELD_MC600M_SP ( 
  IN $P_COR VARCHAR(3) , 
  IN $P_FDT VARCHAR(8) , 
  IN $P_TDT VARCHAR(8) ) 
  DYNAMIC RESULT SETS 1 
  LANGUAGE SQL 
  SPECIFIC MCLISOLIB.SEL02_CORONA19REALTIMESTSBYFIELD_MC600M_SP 
  NOT DETERMINISTIC 
  MODIFIES SQL DATA 
  CALLED ON NULL INPUT 
  SET OPTION  ALWBLK = *ALLREAD , 
  ALWCPYDTA = *OPTIMIZE , 
  COMMIT = *CHG , 
  DBGVIEW = *SOURCE , 
  DECRESULT = (31, 31, 00) , 
  DFTRDBCOL = *NONE , 
  DLYPRP = *NO , 
  DYNDFTCOL = *NO , 
  DYNUSRPRF = *USER , 
  SRTSEQ = *HEX 
  BEGIN  -- IDR 유승현 미래년도 제거 
DECLARE CUR CURSOR FOR 
SELECT CASE WHEN $P_FDT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN UX'B2F9C77C000F' ELSE '전일' END AS DATE_VAL , '접수건수' AS PROGRESS_NM , IFNULL ( SCNT , 0 ) AS SCNT , IFNULL ( BCNT , 0 ) AS BCNT , IFNULL ( DCNT , 0 ) AS DCNT , IFNULL ( GCNT , 0 ) AS GCNT , IFNULL ( JCNT , 0 ) AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
, SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
FROM MCLISDLIB . MC600M@ 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT = $P_FDT 
/* 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
*/ 
) 
AND F600GCD IN ( '71330' , '71331' , '71332' , '71334' , '71337' , '71338' , '71340' , '71341' , '71346' , '71349' , '71350' , '71351' , '72276' ) 
AND F600ACD IN ( '' , '00' ) 
) 
UNION ALL 
SELECT CASE WHEN $P_FDT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN UX'B2F9C77C000F' ELSE '전일' END AS DATE_VAL , '도착건수' AS PROGRESS_NM , IFNULL ( SCNT , 0 ) , IFNULL ( BCNT , 0 ) , IFNULL ( DCNT , 0 ) , IFNULL ( GCNT , 0 ) , IFNULL ( JCNT , 0 ) AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
, SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111H@ 
ON F600COR = H111COR 
AND F600DAT = H111DAT 
AND F600JNO = H111JNO 
AND H111SEQ = 0 
WHERE F600COR = $P_COR 
AND 
( 
	 
	F600DAT = $P_FDT 
/* 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
*/ 
) 
AND F600GCD IN ( '71330' , '71331' , '71332' , '71334' , '71337' , '71338' , '71340' , '71341' , '71346' , '71349' , '71350' , '71351' , '72276' ) 
AND F600ACD IN ( '' , '00' ) 
) 
UNION ALL 
SELECT CASE WHEN $P_FDT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN UX'B2F9C77C000F' ELSE '전일' END AS DATE_VAL , '핵산추출진행' AS PROGRESS_NM , IFNULL ( SCNT , 0 ) , IFNULL ( BCNT , 0 ) , IFNULL ( DCNT , 0 ) , IFNULL ( GCNT , 0 ) , IFNULL ( JCNT , 0 ) AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
, SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
FROM MCLISDLIB . MC600M@ 
INNER JOIN XCEEDIDLIB . CM_TAT_LOG HEX 
ON F600COR = HEX . COMPANY 
AND F600DAT = HEX . RECEPT_DATE 
AND F600JNO = HEX . RECEPT_SEQUENCE 
AND HEX . TAT_CATEGORY = 'HEXANE' AND HEX . TAT_SEQUENCE = 0 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT = $P_FDT 
/* 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
*/ 
) 
AND F600GCD IN ( SELECT F999CD3 FROM MCLISDLIB . MC999D@ WHERE F999COR = $P_COR 
AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' ) 
AND F600ACD IN ( '' , '00' ) 
) 
UNION ALL 
SELECT CASE WHEN $P_FDT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN UX'B2F9C77C000F' ELSE '전일' END AS DATE_VAL , 'PCR진행' AS PROGRESS_NM , IFNULL ( SCNT , 0 ) , IFNULL ( BCNT , 0 ) , IFNULL ( DCNT , 0 ) , IFNULL ( GCNT , 0 ) , IFNULL ( JCNT , 0 ) AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
, SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
FROM MCLISDLIB . MC600M@ 
INNER JOIN XCEEDIDLIB . CM_TAT_LOG PCR 
ON F600COR = PCR . COMPANY 
AND F600DAT = PCR . RECEPT_DATE 
AND F600JNO = PCR . RECEPT_SEQUENCE 
AND PCR . TAT_CATEGORY = 'PCR' AND PCR . TAT_SEQUENCE = 0 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT = $P_FDT 
/* 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
*/ 
) 
AND F600GCD IN ( SELECT F999CD3 FROM MCLISDLIB . MC999D@ WHERE F999COR = $P_COR 
AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' ) 
AND F600ACD IN ( '' , '00' ) 
) 
UNION ALL 
SELECT CASE WHEN $P_FDT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN UX'B2F9C77C000F' ELSE '전일' END AS DATE_VAL , '결과완료' AS PROGRESS_NM , IFNULL ( SCNT , 0 ) , IFNULL ( BCNT , 0 ) , IFNULL ( DCNT , 0 ) , IFNULL ( GCNT , 0 ) , IFNULL ( JCNT , 0 ) AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
, SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
FROM MCLISDLIB . MC600M@ 
WHERE F600COR = $P_COR 
AND 
( 
	 
	F600DAT = $P_FDT 
/* 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
*/ 
) 
AND F600GCD IN ( '71330' , '71331' , '71332' , '71334' , '71337' , '71338' , '71340' , '71341' , '71346' , '71349' , '71350' , '71351' , '72276' ) 
AND F600ACD IN ( '' , '00' ) 
AND F600C03 = 'Y' 
AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) 
) 
UNION ALL 
SELECT CASE WHEN $P_FDT = TO_CHAR ( CURRENT TIMESTAMP , 'yyyymmdd' ) THEN UX'B2F9C77C000F' ELSE '전일' END AS DATE_VAL , '완료율' AS PROGRESS_NM 
, IFNULL ( TRUNCATE ( ROUND ( ( CAST ( COALESCE ( MAX ( SBCNT ) , 0 ) AS DECFLOAT ) / MAX ( SCNT ) ) * 100.00 , 1 ) , 1 ) , 0.0 ) 
, IFNULL ( TRUNCATE ( ROUND ( ( CAST ( COALESCE ( MAX ( BBCNT ) , 0 ) AS DECFLOAT ) / MAX ( BCNT ) ) * 100.00 , 1 ) , 1 ) , 0.0 ) 
, IFNULL ( TRUNCATE ( ROUND ( ( CAST ( COALESCE ( MAX ( DBCNT ) , 0 ) AS DECFLOAT ) / MAX ( DCNT ) ) * 100.00 , 1 ) , 1 ) , 0.0 ) 
, IFNULL ( TRUNCATE ( ROUND ( ( CAST ( COALESCE ( MAX ( GBCNT ) , 0 ) AS DECFLOAT ) / MAX ( GCNT ) ) * 100.00 , 1 ) , 1 ) , 0.0 ) 
, IFNULL ( TRUNCATE ( ROUND ( ( CAST ( COALESCE ( MAX ( JBCNT ) , 0 ) AS DECFLOAT ) / MAX ( JCNT ) ) * 100.00 , 1 ) , 1 ) , 0.0 ) 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
, SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
, SUM ( CASE WHEN F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) AS TBCNT 
, SUM ( CASE WHEN F600CNO = '' AND F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) SBCNT 
, SUM ( CASE WHEN F600CNO = '6526' AND F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) BBCNT 
, SUM ( CASE WHEN F600CNO = '6520' AND F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) DBCNT 
, SUM ( CASE WHEN F600CNO = '6540' AND F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) GBCNT 
, SUM ( CASE WHEN F600CNO = '6550' AND F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) JBCNT 
FROM MCLISDLIB . MC600M@ 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT = $P_FDT 
/* 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
*/ 
) 
AND F600GCD IN ( '71330' , '71331' , '71332' , '71334' , '71337' , '71338' , '71340' , '71341' , '71346' , '71349' , '71350' , '71351' , '72276' ) 
AND F600ACD IN ( '' , '00' ) 
) ; 
OPEN CUR ; 
SET RESULT SETS CURSOR CUR ; 
END  ; 
