--  Generate SQL 
--  Version:                   V7R4M0 190621 
--  Generated on:              22/12/09 13:16:16 
--  Relational Database:       NEODIN 
--  Standards Option:          Db2 for i 
--DROP SPECIFIC PROCEDURE IF EXISTS MCLISOLIB.SEL02_BRANCHWEEKLYCNT_MC600M_SP ; 
--SET PATH "QSYS","QSYS2","SYSPROC","SYSIBMADM","NEO030" ; 
CREATE OR REPLACE PROCEDURE MCLISOLIB.SEL02_BRANCHWEEKLYCNT_MC600M_SP ( 
  IN $P_COR VARCHAR(3) ) 
  DYNAMIC RESULT SETS 1 
  LANGUAGE SQL 
  SPECIFIC MCLISOLIB.SEL02_BRANCHWEEKLYCNT_MC600M_SP 
  NOT DETERMINISTIC 
  MODIFIES SQL DATA 
  CALLED ON NULL INPUT 
  SET OPTION  ALWBLK = *ALLREAD , 
  ALWCPYDTA = *OPTIMIZE , 
  COMMIT = *NONE , 
  DECRESULT = (31, 31, 00) , 
  DYNDFTCOL = *NO , 
  DYNUSRPRF = *USER , 
  SRTSEQ = *HEX 
  BEGIN 
DECLARE CUR CURSOR FOR 
SELECT ( SELECT CURRENT DATE - 7 DAY FROM SYSIBM . SYSDUMMY1 ) , CNT1 , CNT2 , CNT3 , CNT4 , CNT5 , CNT6 
FROM ( 
SELECT 
SUM ( 1 ) CNT1 , 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) CNT2 , 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) CNT3 , 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) CNT4 , 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) CNT5 , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) CNT6 
FROM MCLISDLIB . MC600M@ 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = REPLACE ( CHAR ( CURRENT DATE - 7 DAY ) , '-' , '' ) AND F600ACD IN ( '' , '00' ) AND F999CD3 IS NULL 
) 
UNION ALL 
SELECT ( SELECT CURRENT DATE - 6 DAY FROM SYSIBM . SYSDUMMY1 ) , CNT1 , CNT2 , CNT3 , CNT4 , CNT5 , CNT6 
FROM ( 
SELECT 
SUM ( 1 ) CNT1 , 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) CNT2 , 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) CNT3 , 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) CNT4 , 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) CNT5 , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) CNT6 
FROM MCLISDLIB . MC600M@ 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = REPLACE ( CHAR ( CURRENT DATE - 6 DAY ) , '-' , '' ) AND F600ACD IN ( '' , '00' ) AND F999CD3 IS NULL 
) 
UNION ALL 
SELECT ( SELECT CURRENT DATE - 5 DAY FROM SYSIBM . SYSDUMMY1 ) , CNT1 , CNT2 , CNT3 , CNT4 , CNT5 , CNT6 
FROM ( 
SELECT 
SUM ( 1 ) CNT1 , 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) CNT2 , 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) CNT3 , 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) CNT4 , 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) CNT5 , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) CNT6 
FROM MCLISDLIB . MC600M@ 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = REPLACE ( CHAR ( CURRENT DATE - 5 DAY ) , '-' , '' ) AND F600ACD IN ( '' , '00' ) AND F999CD3 IS NULL 
) 
UNION ALL 
SELECT ( SELECT CURRENT DATE - 4 DAY FROM SYSIBM . SYSDUMMY1 ) , CNT1 , CNT2 , CNT3 , CNT4 , CNT5 , CNT6 
FROM ( 
SELECT 
SUM ( 1 ) CNT1 , 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) CNT2 , 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) CNT3 , 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) CNT4 , 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) CNT5 , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) CNT6 
FROM MCLISDLIB . MC600M@ 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = REPLACE ( CHAR ( CURRENT DATE - 4 DAY ) , '-' , '' ) AND F600ACD IN ( '' , '00' ) AND F999CD3 IS NULL 
) 
UNION ALL 
SELECT ( SELECT CURRENT DATE - 3 DAY FROM SYSIBM . SYSDUMMY1 ) , CNT1 , CNT2 , CNT3 , CNT4 , CNT5 , CNT6 
FROM ( 
SELECT 
SUM ( 1 ) CNT1 , 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) CNT2 , 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) CNT3 , 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) CNT4 , 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) CNT5 , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) CNT6 
FROM MCLISDLIB . MC600M@ 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = REPLACE ( CHAR ( CURRENT DATE - 3 DAY ) , '-' , '' ) AND F600ACD IN ( '' , '00' ) AND F999CD3 IS NULL 
) 
UNION ALL 
SELECT ( SELECT CURRENT DATE - 2 DAY FROM SYSIBM . SYSDUMMY1 ) , CNT1 , CNT2 , CNT3 , CNT4 , CNT5 , CNT6 
FROM ( 
SELECT 
SUM ( 1 ) CNT1 , 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) CNT2 , 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) CNT3 , 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) CNT4 , 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) CNT5 , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) CNT6 
FROM MCLISDLIB . MC600M@ 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = REPLACE ( CHAR ( CURRENT DATE - 2 DAY ) , '-' , '' ) AND F600ACD IN ( '' , '00' ) AND F999CD3 IS NULL 
) 
UNION ALL 
SELECT ( SELECT CURRENT DATE - 1 DAY FROM SYSIBM . SYSDUMMY1 ) , CNT1 , CNT2 , CNT3 , CNT4 , CNT5 , CNT6 
FROM ( 
SELECT 
SUM ( 1 ) CNT1 , 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) CNT2 , 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) CNT3 , 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) CNT4 , 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) CNT5 , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) CNT6 
FROM MCLISDLIB . MC600M@ 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND F600DAT = REPLACE ( CHAR ( CURRENT DATE - 1 DAY ) , '-' , '' ) AND F600ACD IN ( '' , '00' ) AND F999CD3 IS NULL 
) ; 
OPEN CUR ; 
SET RESULT SETS CURSOR CUR ; 
END  ; 
