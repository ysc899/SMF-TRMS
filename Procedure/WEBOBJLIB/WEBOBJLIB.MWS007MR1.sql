DROP PROCEDURE WEBOBJLIB.MWS007MR1;

CREATE PROCEDURE WEBOBJLIB.MWS007MR1
(
	  IN I_COR 		VARCHAR(3) 		
	, IN I_UID 		VARCHAR(12) 	
	, IN I_IP		VARCHAR(30)		
	, OUT O_MSGCOD	VARCHAR(3)		
	, OUT O_ERRCOD	VARCHAR(10)		
	, IN I_AGR		VARCHAR(20)		
)
LANGUAGE SQL
DYNAMIC RESULT SETS 1
BEGIN
	-- 메인 퀵셋업, 권한별 퀵셋업 메뉴 목록 호출	
	DECLARE CUR1 CURSOR WITH RETURN FOR 
		
	   SELECT 
	    CONNECT_BY_ROOT S001PMCD  AS ROOT
	    , TRIM(S001COR) S001COR
	    , TRIM(S001MCD) S001MCD
	    , TRIM(S001PMCD) AS S001PMCD
	    , TRIM(S003HRC) AS S003HRC
	    , TRIM(S003ACD) AS S003ACD
	    , TRIM ( S003CNT ) AS S003CNT
	    , TRIM(S001MNM) AS S001MNM
	    , TRIM(S001PTH) AS S001PTH
	    , LEVEL AS LEVEL_COUNT
	    , S001SEQ
	    , TRIM(S001ICN) AS S001ICN
	   -- , CONNECT_BY_ROOT TREE
    FROM WEBDBLIB.MWS001M@ 
    ,(
		SELECT S003COR , S003ACD , S003MCD , S003HRC, (SELECT COUNT(*) FROM WEBDBLIB."MWS007M@"
														WHERE A.S003COR = S007COR AND A.S003MCD = S007MCD AND S007COR = I_COR) S003CNT
		FROM WEBDBLIB . MWS003M@ A
		WHERE S003COR = I_COR
		AND S003ACD = I_AGR
	) S003
	WHERE S001COR = I_COR
	AND S001COR = S003COR
	AND S001MCD = S003MCD
	AND S001UYN = 'Y'
    START WITH S001PMCD = 'ROOT'
    CONNECT BY   PRIOR S001MCD = S001PMCD --= CASE WHEN  S001MCD 
    ORDER SIBLINGS  BY S001SEQ;
	OPEN CUR1; 
	
	SET O_MSGCOD = '200';
	SET O_ERRCOD = '';
	
END