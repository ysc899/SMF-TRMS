DROP PROCEDURE WEBOBJLIB.MWS001R5;

CREATE  PROCEDURE WEBOBJLIB.MWS001R5
(
      IN I_COR      VARCHAR(3)   -- COR
    , IN I_UID      VARCHAR(12) -- 사용자 ID
    , IN I_IP       VARCHAR(30)  -- 로그인 IP
    , OUT O_MSGCOD  VARCHAR(3)       -- 메세지 코드
    , OUT O_ERRCOD  VARCHAR(10)    	-- 에러 코드
)
LANGUAGE SQL
DYNAMIC RESULT SETS 1
BEGIN
        -- 메뉴 리스트 조회
    DECLARE CUR1  CURSOR WITH RETURN FOR 
   
    SELECT 
	    CONNECT_BY_ROOT S001PMCD  AS ROOT
	    , TRIM(S001MCD) S001MCD
	    , TRIM(S001PMCD) AS S001PMCD
	    , TRIM(S003HRC) AS S003HRC
	    , TRIM(S003ACD) AS S003ACD
	    , TRIM(S001MNM) AS S001MNM
	    , TRIM(S001PTH) AS S001PTH
	    , LEVEL AS LEVEL_COUNT
	    , S001SEQ
	    , TRIM(S001ICN) AS S001ICN
	   -- , CONNECT_BY_ROOT TREE
    FROM WEBDBLIB.MWS001M@ 
    ,(
		SELECT S003COR, S003ACD, S003MCD,S003HRC
		FROM WEBDBLIB.MWS003M@
		WHERE S003COR = I_COR
		AND (S003COR,S003ACD )
			= (SELECT S005COR,S005AGR  
				FROM WEBDBLIB.MWS005M@
				WHERE S005COR = I_COR
				AND S005UID = I_UID)
	) S003
	WHERE S001COR = I_COR
	AND S001COR = S003COR
	AND S001MCD = S003MCD
	AND S001UYN = 'Y'
    START WITH S001PMCD = 'ROOT'
    CONNECT BY   PRIOR S001MCD = S001PMCD --= CASE WHEN  S001MCD 
    ORDER SIBLINGS  BY S001SEQ;

	SET O_MSGCOD = '200';
    OPEN CUR1;
END