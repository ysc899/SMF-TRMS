--  Generate SQL 
--  Version:                   V7R4M0 190621 
--  Generated on:              22/12/09 13:18:50 
--  Relational Database:       NEODIN 
--  Standards Option:          Db2 for i 
--DROP SPECIFIC PROCEDURE IF EXISTS MCLISOLIB.SEL02_REALTIMESTSBYFIELD_MC600M_SP2 ; 
--SET PATH "QSYS","QSYS2","SYSPROC","SYSIBMADM","NEO030" ; 
CREATE OR REPLACE PROCEDURE MCLISOLIB.SEL02_REALTIMESTSBYFIELD_MC600M_SP2 ( 
  IN $P_COR VARCHAR(3) , 
  IN $P_FDT VARCHAR(8) , 
  IN $P_TDT VARCHAR(8) ) 
  DYNAMIC RESULT SETS 1 
  LANGUAGE SQL 
  SPECIFIC MCLISOLIB.SEL02_REALTIMESTSBYFIELD_MC600M_SP2 
  NOT DETERMINISTIC 
  MODIFIES SQL DATA 
  CALLED ON NULL INPUT 
  SET OPTION  ALWBLK = *ALLREAD , 
  ALWCPYDTA = *OPTIMIZE , 
  COMMIT = *CHG , 
  DBGVIEW = *SOURCE , 
  DECRESULT = (31, 31, 00) , 
  DFTRDBCOL = *NONE , 
  DLYPRP = *NO , 
  DYNDFTCOL = *NO , 
  DYNUSRPRF = *USER , 
  SRTSEQ = *HEX 
  BEGIN 
DECLARE CUR CURSOR FOR 
SELECT '야간' , '접수건수' , DECIMAL ( IFNULL ( SCNT , 0 ) ) || 
'' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT  -- 20221208 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = 'NML' AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F970STS = 'E' AND A 
. F999CD3 IS NULL AND B . F999CD3 IS NULL  --  
) 
UNION ALL 
SELECT '야간' , '검사대기' , DECIMAL ( IFNULL ( SCNT , 0 ) ) || 
'' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT  -- 20221208 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F600GNO = 0 AND A . F999CD3 IS NULL AND F600C03 = '' AND B . F999CD3 IS NULL 
) 
UNION ALL 
SELECT '야간' , '검사진행' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111D07 
ON F111COR = F600COR AND F111DAT = F600DAT AND 
F111JNO = F600JNO AND F111GNO = F600GNO 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F970STS = 'E' AND F111C01 = 'Y' AND F600C03 = '' AND A . F999CD3 IS NULL AND B . F999CD3 IS NULL 
) 
UNION ALL 
SELECT '야간' , '검사완료' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F970STS = 'E' AND F600C03 = 'Y' AND A . F999CD3 IS NULL AND B . F999CD3 IS NULL 
) 
UNION ALL 
--SELECT '' , '' , IFNULL ( SUBSTRING ( SCNT , 1 , 2 ) || ':' || SUBSTRING 
-- 
-- 
-- ( SCNT , 3 , 2 ) || ':' || SUBSTRING ( SCNT , 5 , 2 ) , '00:00:00' ) || '' 
--AS SCNT , IFNULL ( SUBSTRING ( BCNT , 1 , 2 ) || ':' || SUBSTRING ( BCNT , 3 
-- , 2 ) || ':' || SUBSTRING ( BCNT , 5 , 2 ) , '00:00:00' ) || '' AS BCNT , 
--IFNULL ( SUBSTRING ( DCNT , 1 , 2 ) || ':' || SUBSTRING ( DCNT , 3 , 2 ) || ': 
-- 
-- 
--' || SUBSTRING ( DCNT , 5 , 2 ) , '00:00:00' ) || '' AS DCNT , IFNULL ( SUBS 
--TRING ( GCNT , 1 , 2 ) || ':' || SUBSTRING ( GCNT , 3 , 2 ) || ':' || SUBSTR 
--ING ( GCNT , 5 , 2 ) , '00:00:00' ) || '' AS GCNT 
SELECT '야간' , '마감시간' 
, '0' AS SCNT 
, '0' AS BCNT 
, '0' AS DCNT 
, '0' AS GCNT 
, '0' AS JCNT 
FROM ( 
SELECT 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '0000' AND F615DNC = 'N' THEN F615TIM END 
) , 9 , 6 ) SCNT ,  ---- 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '6526' AND F615DNC = 'N' THEN F615TIM END 
) , 9 , 6 ) BCNT ,  ---- 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '6520' AND F615DNC = 'N' THEN F615TIM END 
) , 9 , 6 ) DCNT ,  ---- 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '6540' AND F615DNC = 'N' THEN F615TIM END 
) , 9 , 6 ) GCNT ,  ---- 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '6550' AND F615DNC = 'N' THEN F615TIM END 
) , 9 , 6 ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
LEFT JOIN MCLISDLIB . MC615M@ 
ON F615COR = F600COR AND F615DAT = F600DAT 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F970STS = 'E' AND F600C03 = 'Y' AND A . F999CD3 IS NULL AND B . F999CD3 IS NULL  --  
) 
UNION ALL 
SELECT '야간' , '마감율' 
, CASE WHEN ( SCNT = 0 OR ( 100.00 * SCNT2 / SCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * SCNT2 / SCNT ) , '990.99' ) END || '%' AS SCNT 
, CASE WHEN ( BCNT = 0 OR ( 100.00 * BCNT2 / BCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * BCNT2 / BCNT ) , '990.99' ) END || '%' AS BCNT 
, CASE WHEN ( DCNT = 0 OR ( 100.00 * DCNT2 / DCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * DCNT2 / DCNT ) , '990.99' ) END || '%' AS DCNT 
, CASE WHEN ( GCNT = 0 OR ( 100.00 * GCNT2 / GCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * GCNT2 / GCNT ) , '990.99' ) END || '%' AS GCNT 
, CASE WHEN ( JCNT = 0 OR ( 100.00 * JCNT2 / JCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * JCNT2 / JCNT ) , '990.99' ) END || '%' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) SCNT2 ,  ---- 
-- 
-- 
-- 
SUM ( CASE WHEN F600CNO = '6526' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) BCNT2 , 
---- 
SUM ( CASE WHEN F600CNO = '6520' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) DCNT2 , 
---- 
SUM ( CASE WHEN F600CNO = '6540' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) GCNT2 ,  -- 
-- 
SUM ( CASE WHEN F600CNO = '6550' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) JCNT2  -- 
-- 
---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND A . F999CD3 IS NULL AND B . F999CD3 IS NULL 
) 
UNION ALL 
SELECT '주간' , '접수건수' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = 'NML' AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'D' AND F970STS = 'E' AND A 
. F999CD3 IS NULL AND B . F999CD3 IS NULL  --  
) 
UNION ALL 
SELECT '주간' , '검사대기' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'D' AND F970STS = 'E' AND F600GNO = 0 AND A . F999CD3 IS NULL AND F600C03 = '' AND B . F999CD3 IS NULL 
) 
UNION ALL 
SELECT '주간' , '검사진행' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111D07 
ON F111COR = F600COR AND F111DAT = F600DAT AND 
F111JNO = F600JNO AND F111GNO = F600GNO 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'D' AND F970STS = 'E' AND F111C01 = 'Y' AND F600C03 = '' AND A . F999CD3 IS NULL AND B . F999CD3 IS NULL 
) 
UNION ALL 
SELECT '주간' , '검사완료' 
, DECIMAL ( IFNULL ( SCNT , 0 ) ) || '' AS SCNT 
, DECIMAL ( IFNULL ( BCNT , 0 ) ) || '' AS BCNT 
, DECIMAL ( IFNULL ( DCNT , 0 ) ) || '' AS DCNT 
, DECIMAL ( IFNULL ( GCNT , 0 ) ) || '' AS GCNT 
, DECIMAL ( IFNULL ( JCNT , 0 ) ) || '' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'D' AND F970STS = 'E' AND F600C03 = 'Y' AND A . F999CD3 IS NULL AND B . F999CD3 IS NULL 
) 
UNION ALL 
--SELECT '' , '' , IFNULL ( SUBSTRING ( SCNT , 1 , 2 ) || ':' || SUBSTRING 
-- 
-- 
-- ( SCNT , 3 , 2 ) || ':' || SUBSTRING ( SCNT , 5 , 2 ) , '00:00:00' ) || '' 
--AS SCNT , IFNULL ( SUBSTRING ( BCNT , 1 , 2 ) || ':' || SUBSTRING ( BCNT , 3 
-- , 2 ) || ':' || SUBSTRING ( BCNT , 5 , 2 ) , '00:00:00' ) || '' AS BCNT , 
--IFNULL ( SUBSTRING ( DCNT , 1 , 2 ) || ':' || SUBSTRING ( DCNT , 3 , 2 ) || ': 
-- 
-- 
--' || SUBSTRING ( DCNT , 5 , 2 ) , '00:00:00' ) || '' AS DCNT , IFNULL ( SUBS 
--TRING ( GCNT , 1 , 2 ) || ':' || SUBSTRING ( GCNT , 3 , 2 ) || ':' || SUBSTR 
--ING ( GCNT , 5 , 2 ) , '00:00:00' ) || '' AS GCNT 
SELECT '주간' , '마감시간' 
, '0' AS SCNT 
, '0' AS BCNT 
, '0' AS DCNT 
, '0' AS GCNT 
, '0' AS JCNT 
FROM ( 
SELECT 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '0000' AND F615DNC = 'D' THEN F615TIM END 
) , 9 , 6 ) SCNT ,  ---- 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '6526' AND F615DNC = 'D' THEN F615TIM END 
) , 9 , 6 ) BCNT ,  ---- 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '6520' AND F615DNC = 'D' THEN F615TIM END 
) , 9 , 6 ) DCNT ,  ---- 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '6540' AND F615DNC = 'D' THEN F615TIM END 
) , 9 , 6 ) GCNT ,  ---- 
SUBSTRING ( MAX ( CASE WHEN F615LMB = '6550' AND F615DNC = 'D' THEN F615TIM END 
) , 9 , 6 ) JCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
LEFT JOIN MCLISDLIB . MC615M@ 
ON F615COR = F600COR AND F615DAT = F600DAT 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'D' AND F970STS = 'E' AND F600C03 = 'Y' AND A . F999CD3 IS NULL AND B . F999CD3 IS NULL  --  
) 
UNION ALL 
SELECT '주간' , '마감율' 
, CASE WHEN ( SCNT = 0 OR ( 100.00 * SCNT2 / SCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * SCNT2 / SCNT ) , '990.99' ) END || '%' AS SCNT 
, CASE WHEN ( BCNT = 0 OR ( 100.00 * BCNT2 / BCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * BCNT2 / BCNT ) , '990.99' ) END || '%' AS BCNT 
, CASE WHEN ( DCNT = 0 OR ( 100.00 * DCNT2 / DCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * DCNT2 / DCNT ) , '990.99' ) END || '%' AS DCNT 
, CASE WHEN ( GCNT = 0 OR ( 100.00 * GCNT2 / GCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * GCNT2 / GCNT ) , '990.99' ) END || '%' AS GCNT 
, CASE WHEN ( GCNT = 0 OR ( 100.00 * JCNT2 / JCNT ) = 0 ) THEN '0.00' ELSE VARCHAR_FORMAT ( ( 100.00 * JCNT2 / JCNT ) , '990.99' ) END || '%' AS JCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) SCNT2 ,  ---- 
-- 
-- 
-- 
SUM ( CASE WHEN F600CNO = '6526' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) BCNT2 , 
---- 
SUM ( CASE WHEN F600CNO = '6520' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) DCNT2 , 
---- 
SUM ( CASE WHEN F600CNO = '6540' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) GCNT2 ,  -- 
-- 
SUM ( CASE WHEN F600CNO = '6550' AND F600C03 = 'Y' THEN 1 ELSE 0 END ) JCNT2  -- 
-- 
---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS A 
ON A . F999COR = F600COR AND A . F999CD1 = 'CLIC' AND A . F999CD2 = 'COVI' AND A . F999CD3 = F600GCD 
LEFT OUTER JOIN MCLISDLIB . MC999D@ AS B 
ON B . F999COR = F600COR AND B . F999CD1 = 'STTT' AND B . F999CD2 = 'EXHS' AND B . F999CD3 = F600HOS 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'D' AND F970STS = 'E' AND A . F999CD3 IS NULL AND B . F999CD3 IS NULL 
) ; 
OPEN CUR ; 
SET RESULT SETS CURSOR CUR ; 
END  ; 
