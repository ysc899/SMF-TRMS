--  Generate SQL 
--  Version:                   V7R2M0 140418 
--  Generated on:              21/09/24 15:48:51 
--  Relational Database:       NEODIN 
--  Standards Option:          DB2 for i 
--DROP SPECIFIC PROCEDURE MCLISOLIB.SEL02_REALTIMESTSBYFIELD_MC600M_SP ; 
--SET PATH "QSYS","QSYS2","SYSPROC","SYSIBMADM","NEO007" ; 
CREATE OR REPLACE PROCEDURE MCLISOLIB.SEL02_REALTIMESTSBYFIELD_MC600M_SP ( 
  IN $P_COR VARCHAR(3) , 
  IN $P_FDT VARCHAR(8) , 
  IN $P_TDT VARCHAR(8) ) 
  DYNAMIC RESULT SETS 1 
  LANGUAGE SQL 
  SPECIFIC MCLISOLIB.SEL02_REALTIMESTSBYFIELD_MC600M_SP 
  NOT DETERMINISTIC 
  MODIFIES SQL DATA 
  CALLED ON NULL INPUT 
  SET OPTION  ALWBLK = *ALLREAD , 
  ALWCPYDTA = *OPTIMIZE , 
  COMMIT = *CHG , 
  DBGVIEW = *SOURCE , 
  DECRESULT = (31, 31, 00) , 
  DFTRDBCOL = *NONE , 
  DLYPRP = *NO , 
  DYNDFTCOL = *NO , 
  DYNUSRPRF = *USER , 
  SRTSEQ = *HEX 
  BEGIN 
DECLARE CUR CURSOR FOR 
SELECT UX'001A001A' , UX'001A001A001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = 'NML' 
AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F999CD3 IS NULL  -- 
-- 
) 
UNION ALL 
SELECT UX'001A001A' , UX'001A001A001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F600GNO = 0 AND F999CD3 IS NULL AND F600C03 = '' 
) 
UNION ALL 
SELECT UX'001A001A' , UX'001A001A001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111D07 
ON F111COR = F600COR AND F111DAT = F600DAT AND 
F111JNO = F600JNO AND F111GNO = F600GNO 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F111C01 = 'Y' AND F600C03 = '' AND F999CD3 IS NULL 
) 
UNION ALL 
SELECT UX'001A001A' , UX'001A001A001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT ,  ---- 
SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F600C03 = 'Y' AND F999CD3 IS NULL 
) 
UNION ALL 
SELECT UX'001A001A' , UX'001A001A001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
MAX ( CASE WHEN F600CNO = '' AND F600CDT = 20210121 THEN F600CTM END ) SCNT ,  ---- 
MAX ( CASE WHEN F600CNO = '6526' AND F600CDT = 20210121 THEN F600CTM END ) BCNT ,  ---- 
MAX ( CASE WHEN F600CNO = '6520' AND F600CDT = 20210121 THEN F600CTM END ) DCNT ,  ---- 
MAX ( CASE WHEN F600CNO = '6540' AND F600CDT = 20210121 THEN F600CTM END ) GCNT  ---- 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC970M@ 
ON F970COR = F600COR AND F970DPT = F600HAK AND F970JOB = F600JOB 
LEFT OUTER JOIN MCLISDLIB . MC999D@ 
ON F999COR = F600COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' AND F999CD3 = F600GCD 
WHERE F600COR = $P_COR AND ( F600DAT >= $P_FDT AND F600DAT <= $P_TDT ) AND F600ACD IN ( '' , '00' ) AND F600C05 <> 'N' AND F970DNC = 'N' AND F600C03 = 'Y' AND F999CD3 IS NULL  --  
) 
UNION ALL 
SELECT UX'001A001A001A' , UX'001A001A001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
FROM MCLISDLIB . MC600M@ 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT BETWEEN $P_FDT AND $P_TDT 
	OR F600DAT BETWEEN '2023' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2023' || SUBSTRING ( $P_TDT , 5 , 4 ) 
    OR F600DAT BETWEEN '2027' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2027' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2028' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2028' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2029' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2029' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2030' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2030' || SUBSTRING ( $P_TDT , 5 , 4 )
) 
AND F600GCD IN ( '71330' , '71331' , '71332' , '71334' , '71337' , '71338' , '71340' , '71341' , '71342' , '71346' , '71349' , '71350' , '71351' ) 
AND F600ACD IN ( '' , '00' ) 
) 
UNION ALL 
SELECT UX'001A001A001A' , UX'001A001A001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
FROM MCLISDLIB . MC600M@ 
INNER JOIN MCLISDLIB . MC111H@ 
ON F600COR = H111COR 
AND F600DAT = H111DAT 
AND F600JNO = H111JNO 
AND H111SEQ = 0 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT BETWEEN $P_FDT AND $P_TDT 
	OR F600DAT BETWEEN '2023' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2023' || SUBSTRING ( $P_TDT , 5 , 4 ) 
    OR F600DAT BETWEEN '2027' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2027' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2028' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2028' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2029' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2029' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2030' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2030' || SUBSTRING ( $P_TDT , 5 , 4 )
) 
AND F600GCD IN ( '71330' , '71331' , '71332' , '71334' , '71338' , '71341' , '71342' , '71349' , '71350' , '71351' ) 
AND F600ACD IN ( '' , '00' ) 
) 
UNION ALL 
SELECT UX'001A001A001A' , UX'001A001A001A001A001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
FROM MCLISDLIB . MC600M@ 
INNER JOIN XCEEDIDLIB . CM_TAT_LOG HEX 
ON F600COR = HEX . COMPANY 
AND F600DAT = HEX . RECEPT_DATE 
AND F600JNO = HEX . RECEPT_SEQUENCE 
AND HEX . TAT_CATEGORY = 'HEXANE' AND HEX . TAT_SEQUENCE = 0 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT BETWEEN $P_FDT AND $P_TDT 
	OR F600DAT BETWEEN '2023' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2023' || SUBSTRING ( $P_TDT , 5 , 4 ) 
    OR F600DAT BETWEEN '2027' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2027' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2028' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2028' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2029' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2029' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2030' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2030' || SUBSTRING ( $P_TDT , 5 , 4 )
) 
AND F600GCD IN ( SELECT F999CD3 FROM MCLISDLIB . MC999D@ WHERE F999COR = $P_COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' ) 
AND F600ACD IN ( '' , '00' ) 
) 
UNION ALL 
SELECT UX'001A001A001A' , UX'005000430052001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
FROM MCLISDLIB . MC600M@ 
INNER JOIN XCEEDIDLIB . CM_TAT_LOG PCR 
ON F600COR = PCR . COMPANY 
AND F600DAT = PCR . RECEPT_DATE 
AND F600JNO = PCR . RECEPT_SEQUENCE 
AND PCR . TAT_CATEGORY = 'PCR' AND PCR . TAT_SEQUENCE = 0 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT BETWEEN $P_FDT AND $P_TDT 
	OR F600DAT BETWEEN '2023' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2023' || SUBSTRING ( $P_TDT , 5 , 4 ) 
    OR F600DAT BETWEEN '2027' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2027' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2028' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2028' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2029' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2029' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2030' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2030' || SUBSTRING ( $P_TDT , 5 , 4 )
) 
AND F600GCD IN ( SELECT F999CD3 FROM MCLISDLIB . MC999D@ WHERE F999COR = $P_COR AND F999CD1 = 'CLIC' AND F999CD2 = 'COVI' ) 
AND F600ACD IN ( '' , '00' ) 
) 
UNION ALL 
SELECT UX'001A001A001A' , UX'001A001A001A001A' , SCNT , BCNT , DCNT , GCNT 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
FROM MCLISDLIB . MC600M@ 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT BETWEEN $P_FDT AND $P_TDT 
	OR F600DAT BETWEEN '2023' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2023' || SUBSTRING ( $P_TDT , 5 , 4 ) 
    OR F600DAT BETWEEN '2027' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2027' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2028' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2028' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2029' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2029' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2030' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2030' || SUBSTRING ( $P_TDT , 5 , 4 )
) 
AND F600GCD IN ( '71330' , '71331' , '71332' , '71334' , '71337' , '71338' , '71340' , '71341' , '71342' , '71346' , '71349' , '71350' , '71351' ) 
AND F600ACD IN ( '' , '00' ) 
AND F600C03 = 'Y' 
AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) 
) 
UNION ALL 
SELECT UX'001A001A001A' , UX'001A001A001A' 
, IFNULL ( TRUNCATE ( ROUND ( ( CAST ( COALESCE ( MAX ( SBCNT ) , 0 ) AS DECFLOAT ) / MAX ( SCNT ) ) * 100.00 , 1 ) , 1 ) , 0.0 ) 
, IFNULL ( TRUNCATE ( ROUND ( ( CAST ( COALESCE ( MAX ( BBCNT ) , 0 ) AS DECFLOAT ) / MAX ( BCNT ) ) * 100.00 , 1 ) , 1 ) , 0.0 ) 
, IFNULL ( TRUNCATE ( ROUND ( ( CAST ( COALESCE ( MAX ( DBCNT ) , 0 ) AS DECFLOAT ) / MAX ( DCNT ) ) * 100.00 , 1 ) , 1 ) , 0.0 ) 
, IFNULL ( TRUNCATE ( ROUND ( ( CAST ( COALESCE ( MAX ( GBCNT ) , 0 ) AS DECFLOAT ) / MAX ( GCNT ) ) * 100.00 , 1 ) , 1 ) , 0.0 ) 
FROM ( 
SELECT 
SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT 
, SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT 
, SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT 
, SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT 
, SUM ( CASE WHEN F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) AS TBCNT 
, SUM ( CASE WHEN F600CNO = '' AND F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) SBCNT 
, SUM ( CASE WHEN F600CNO = '6526' AND F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) BBCNT 
, SUM ( CASE WHEN F600CNO = '6520' AND F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) DBCNT 
, SUM ( CASE WHEN F600CNO = '6540' AND F600C03 = 'Y' AND ( F600CHR LIKE '%Negative%' OR F600CHR LIKE '%Positive%' ) THEN 1 ELSE 0 END ) GBCNT 
FROM MCLISDLIB . MC600M@ 
WHERE F600COR = $P_COR 
AND 
( 
	F600DAT BETWEEN $P_FDT AND $P_TDT 
	OR F600DAT BETWEEN '2023' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2023' || SUBSTRING ( $P_TDT , 5 , 4 ) 
    OR F600DAT BETWEEN '2027' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2027' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2028' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2028' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2029' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2029' || SUBSTRING ( $P_TDT , 5 , 4 )  
    OR F600DAT BETWEEN '2030' || SUBSTRING ( $P_FDT , 5 , 4 )  AND '2030' || SUBSTRING ( $P_TDT , 5 , 4 )
) 
AND F600GCD IN ( '71330' , '71331' , '71332' , '71334' , '71337' , '71338' , '71340' , '71341' , '71342' , '71346' , '71349' , '71350' , '71351' ) 
AND F600ACD IN ( '' , '00' ) 
) ; 
OPEN CUR ; 
SET RESULT SETS CURSOR CUR ; 
END  ; 
