--  Generate SQL 
--  Version:                   V7R4M0 190621 
--  Generated on:              22/12/09 13:14:38 
--  Relational Database:       NEODIN 
--  Standards Option:          Db2 for i 
--DROP SPECIFIC PROCEDURE IF EXISTS MCLISOLIB.SEL02_CORONA19POSRATE_MC600M_SP ; 
--SET PATH "QSYS","QSYS2","SYSPROC","SYSIBMADM","NEO030" ; 
CREATE OR REPLACE PROCEDURE MCLISOLIB.SEL02_CORONA19POSRATE_MC600M_SP ( 
  IN $P_COR VARCHAR(3) , 
  IN $P_FDT VARCHAR(8) , 
  IN $P_TDT VARCHAR(8) ) 
  DYNAMIC RESULT SETS 1 
  LANGUAGE SQL 
  SPECIFIC MCLISOLIB.SEL02_CORONA19POSRATE_MC600M_SP 
  NOT DETERMINISTIC 
  MODIFIES SQL DATA 
  CALLED ON NULL INPUT 
  SET OPTION  ALWBLK = *ALLREAD , 
  ALWCPYDTA = *OPTIMIZE , 
  COMMIT = *CHG , 
  DBGVIEW = *SOURCE , 
  DECRESULT = (31, 31, 00) , 
  DFTRDBCOL = *NONE , 
  DLYPRP = *NO , 
  DYNDFTCOL = *NO , 
  DYNUSRPRF = *USER , 
  SRTSEQ = *HEX 
  BEGIN  -- IDR 유승현 미래날짜 주석처리, IDR 김경의 미래날짜 로직 변경 부분도 주석처리 
DECLARE CUR CURSOR FOR 
	SELECT UX'AC1CBCC4001A' , 'Positive' , DECIMAL ( TCNT ) || '' , DECIMAL ( SCNT ) || '' , DECIMAL ( BCNT ) || '' , DECIMAL ( DCNT ) || '' , DECIMAL ( GCNT ) || '' , DECIMAL ( JCNT ) || '' 
	FROM ( 
	SELECT 
	SUM ( 1 ) TCNT , 
	SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT , 
	SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT , 
	SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT , 
	SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
	FROM MCLISDLIB . MC600M@ 
	WHERE F600COR = $P_COR 
	AND F600DAT = $P_FDT 
/* 
	( 
	F600DAT = $P_FDT 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	) 
*/ 
	AND F600GCD IN ( '71330' , '71331' , '71332' , '71341' , '71349' , '71350' , '71351' , '72276' ) AND F600C03 = 'Y' AND F600ACD IN ( '' , '00' ) AND F600CHR = 'Positive' 
	) 
	UNION ALL 
	SELECT UX'AC1CBCC4001A' , 'Inconclusive' , DECIMAL ( TCNT ) || '' , DECIMAL ( SCNT ) || '' , DECIMAL ( BCNT ) || '' , DECIMAL ( DCNT ) || '' , DECIMAL ( GCNT ) || '' , DECIMAL ( JCNT ) || '' 
	FROM ( 
	SELECT 
	SUM ( 1 ) TCNT , 
	SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT , 
	SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT , 
	SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT , 
	SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
	FROM MCLISDLIB . MC600M@ 
	WHERE F600COR = $P_COR 
	AND F600DAT = $P_FDT 
/* 
	( 	 
	F600DAT = $P_FDT 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	) 
*/	 
	AND F600GCD IN ( '71330' , '71331' , '71332' , '71341' , '71349' , '71350' , '71351' , '72276' ) AND F600C03 = 'Y' AND F600ACD IN ( '' , '00' ) AND F600CHR LIKE '%Inconclusive%' 
	) 
	UNION ALL 
	SELECT UX'AC1CBCC4001A' , 'Negative' , DECIMAL ( TCNT ) || '' , DECIMAL ( SCNT ) || '' , DECIMAL ( BCNT ) || '' , DECIMAL ( DCNT ) || '' , DECIMAL ( GCNT ) || '' , DECIMAL ( JCNT ) || '' 
	FROM ( 
	SELECT 
	SUM ( 1 ) TCNT , 
	SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT , 
	SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT , 
	SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT , 
	SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
	FROM MCLISDLIB . MC600M@ 
	WHERE F600COR = $P_COR 
	AND F600DAT = $P_FDT 
/*	 
	( 	 
	F600DAT = $P_FDT 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	) 
*/ 
	AND F600GCD IN ( '71330' , '71331' , '71332' , '71341' , '71349' , '71350' , '71351' , '72276' ) AND F600C03 = 'Y' AND F600ACD IN ( '' , '00' ) AND F600CHR = 'Negative' 
	) 
	UNION ALL 
	SELECT UX'AC1CBCC4001A' , '양성율' , VARCHAR_FORMAT ( ( 100.00 * TCNT2 / TCNT ) , '90.999' ) || '%' , VARCHAR_FORMAT ( ( 100.00 * SCNT2 / SCNT ) , '90.999' ) || '%' , VARCHAR_FORMAT ( ( 100.00 * BCNT2 / BCNT ) , '90.999' ) || '%' , 
	VARCHAR_FORMAT ( ( 100.00 * DCNT2 / DCNT ) , '90.999' ) || '%' , VARCHAR_FORMAT ( ( 100.00 * GCNT2 / GCNT ) , '90.999' ) || '%' , VARCHAR_FORMAT ( ( 100.00 * JCNT2 / JCNT ) , '90.999' ) || '%' 
	FROM ( 
	SELECT 
	SUM ( 1 ) TCNT , 
	SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT , 
	SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT , 
	SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT , 
	SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT , 
	SUM ( CASE WHEN ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) TCNT2 , 
	SUM ( CASE WHEN F600CNO = '' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) SCNT2 , 
	SUM ( CASE WHEN F600CNO = '6526' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) BCNT2 , 
	SUM ( CASE WHEN F600CNO = '6520' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) DCNT2 , 
	SUM ( CASE WHEN F600CNO = '6540' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) GCNT2 , 
SUM ( CASE WHEN F600CNO = '6550' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) JCNT2 
	FROM MCLISDLIB . MC600M@ 
	WHERE F600COR = $P_COR 
	AND F600DAT = $P_FDT 
/* 
	( 
	F600DAT = $P_FDT 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	) 
*/	 
	AND F600GCD IN ( '71330' , '71331' , '71332' , '71341' , '71349' , '71350' , '71351' , '72276' ) AND F600C03 = 'Y' AND F600ACD IN ( '' , '00' ) 
	) 
	UNION ALL 
	SELECT UX'CDE8D569001A' , 'Positive' , DECIMAL ( TCNT ) || '' , DECIMAL ( SCNT ) || '' , DECIMAL ( BCNT ) || '' , DECIMAL ( DCNT ) || '' , DECIMAL ( GCNT ) || '' , DECIMAL ( JCNT ) || '' 
	FROM ( 
	SELECT 
	SUM ( 1 ) TCNT , 
	SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT , 
	SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT , 
	SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT , 
	SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
	FROM MCLISDLIB . MC600M@ 
	WHERE F600COR = $P_COR 
	AND F600DAT = $P_FDT 
/* 
	( 
	F600DAT = $P_FDT 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	) 
*/	 
	AND F600GCD IN ( '71334' , '71337' , '71338' , '71340' , '71346' ) AND F600C03 = 'Y' AND F600ACD IN ( '' , '00' ) AND F600CHR LIKE '%Inconclusive%' 
	) 
	UNION ALL 
	SELECT UX'CDE8D569001A' , 'Negative' , DECIMAL ( TCNT ) || '' , DECIMAL ( SCNT ) || '' , DECIMAL ( BCNT ) || '' , DECIMAL ( DCNT ) || '' , DECIMAL ( GCNT ) || '' , DECIMAL ( JCNT ) || '' 
	FROM ( 
	SELECT 
	SUM ( 1 ) TCNT , 
	SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT , 
	SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT , 
	SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT , 
	SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT 
	FROM MCLISDLIB . MC600M@ 
	WHERE F600COR = $P_COR 
	AND F600DAT = $P_FDT 
/* 
	( 
	F600DAT = $P_FDT 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	) 
*/	 
	AND F600GCD IN ( '71334' , '71337' , '71338' , '71340' , '71346' ) AND F600C03 = 'Y' AND F600ACD IN ( '' , '00' ) AND F600CHR = 'Negative' 
	) 
	UNION ALL 
	SELECT UX'CDE8D569001A' , '양성율' , VARCHAR_FORMAT ( ( 100.00 * TCNT2 / TCNT ) , '90.999' ) || '%' , VARCHAR_FORMAT ( ( 100.00 * SCNT2 / SCNT ) , '90.999' ) || '%' , VARCHAR_FORMAT ( ( 100.00 * BCNT2 / BCNT ) , '90.999' ) || '%' , 
	VARCHAR_FORMAT ( ( 100.00 * DCNT2 / DCNT ) , '90.999' ) || '%' , VARCHAR_FORMAT ( ( 100.00 * GCNT2 / GCNT ) , '90.999' ) || '%' 
, VARCHAR_FORMAT ( ( 100.00 * JCNT2 / JCNT ) , '90.999' ) || '%' 
	FROM ( 
	SELECT 
	SUM ( 1 ) TCNT , 
	SUM ( CASE WHEN F600CNO = '' THEN 1 ELSE 0 END ) SCNT , 
	SUM ( CASE WHEN F600CNO = '6526' THEN 1 ELSE 0 END ) BCNT , 
	SUM ( CASE WHEN F600CNO = '6520' THEN 1 ELSE 0 END ) DCNT , 
	SUM ( CASE WHEN F600CNO = '6540' THEN 1 ELSE 0 END ) GCNT , 
SUM ( CASE WHEN F600CNO = '6550' THEN 1 ELSE 0 END ) JCNT , 
	SUM ( CASE WHEN ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) TCNT2 , 
	SUM ( CASE WHEN F600CNO = '' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) SCNT2 , 
	SUM ( CASE WHEN F600CNO = '6526' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) BCNT2 , 
	SUM ( CASE WHEN F600CNO = '6520' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) DCNT2 , 
	SUM ( CASE WHEN F600CNO = '6540' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) GCNT2 , 
SUM ( CASE WHEN F600CNO = '6550' AND ( F600CHR = 'Positive' OR F600CHR LIKE '%Inconclusive%' ) THEN 1 ELSE 0 END ) JCNT2 
	FROM MCLISDLIB . MC600M@ 
	WHERE F600COR = $P_COR 
	AND F600DAT = $P_FDT 
/* 
	( 
	F600DAT = $P_FDT 
	OR F600DAT = '2023' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2024' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2025' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2026' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2037' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2038' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	OR F600DAT = '2039' || SUBSTRING ( $P_FDT , 5 , 4 ) 
	) 
*/	 
	AND F600GCD IN ( '71334' , '71337' , '71338' , '71340' , '71346' ) AND F600C03 = 'Y' AND F600ACD IN ( '' , '00' ) 
	) ; 
OPEN CUR ; 
SET RESULT SETS CURSOR CUR ; 
END  ; 
