DROP SPECIFIC PROCEDURE WEBOBJLIB.SEL_CORONA_RESULT_IMG_SERCH; 
SET PATH "QSYS","QSYS2","SYSPROC","SYSIBMADM","NEO014" ; 
CREATE OR REPLACE PROCEDURE WEBOBJLIB.SEL_CORONA_RESULT_IMG_SERCH( 
  IN $I_SIGN VARCHAR(100)) 
  DYNAMIC RESULT SETS 2 
  LANGUAGE SQL 
  SPECIFIC WEBOBJLIB.SEL_CORONA_RESULT_IMG_SERCH 
  NOT DETERMINISTIC 
  READS SQL DATA 
  CALLED ON NULL INPUT 
  SET OPTION  ALWBLK = *ALLREAD , 
  ALWCPYDTA = *OPTIMIZE , 
  COMMIT = *NONE , 
  DBGVIEW = *SOURCE , 
  DECRESULT = (31, 31, 00) , 
  DFTRDBCOL = *NONE , 
  DLYPRP = *NO , 
  DYNDFTCOL = *NO , 
  DYNUSRPRF = *USER , 
  SRTSEQ = *HEX 
  BEGIN 
	DECLARE CUR_ORDER CURSOR WITH RETURN TO CALLER FOR 
		SELECT BB.S100DAT,	-- 접수일자
			   BB.S100JNO,	-- 접수번호
			   AA.F600GCD,	-- 검사코드
			   GG.F100NAM,	-- 환자명
			   BB.S100PNO,	-- 연락처
			   GG.F100BDT,	-- 생년월일
			   BB.S100HOS	-- 병원코드
		FROM MCLISDLIB."MC600M@" AA 
		LEFT JOIN MCLISDLIB.MC100HSUB@ BB -- 핸드폰번호가 등록된 병원만 SMS 발송을 할수 있게 하기 위한 JOIN 
			ON AA.F600COR = BB.S100COR 
			AND AA.F600DAT = BB.S100DAT 
			AND AA.F600JNO = BB.S100JNO 
			AND AA.F600HOS = BB.S100HOS 
		LEFT JOIN MCLISDLIB.MC100H@ GG 
			ON GG.F100COR = BB.S100COR 
			AND GG.F100DAT = BB.S100DAT 
			AND GG.F100JNO = BB.S100JNO 
			AND GG.F100HOS = BB.S100HOS 
		 WHERE BB.S100TMP8 = $I_SIGN
	; 
OPEN CUR_ORDER ; 
END  ; 
