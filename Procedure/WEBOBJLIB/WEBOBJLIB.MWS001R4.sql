DROP PROCEDURE WEBOBJLIB.MWS001R4;

CREATE  PROCEDURE WEBOBJLIB.MWS001R4
(
      IN I_COR      VARCHAR(3)   -- COR
    , IN I_UID      VARCHAR(12) -- 사용자 ID
    , IN I_IP       VARCHAR(30)  -- 로그인 IP
    , OUT O_MSGCOD  VARCHAR(3)       -- 메세지 코드
    , OUT O_ERRCOD  VARCHAR(10)    -- 에러 코드
    , IN I_PTH      VARCHAR(400)    -- 메뉴 경로
)
LANGUAGE SQL
DYNAMIC RESULT SETS 1
BEGIN
        -- 메뉴 리스트 조회
    DECLARE CUR1  CURSOR WITH RETURN FOR 
   
    SELECT 
   		 TRIM(S001MCD) S001MCD
	    , TRIM(S001PMCD) AS S001PMCD
	    , TRIM(S003HRC) AS S003HRC
	    , IFNULL(TRIM(S003ACD),'AUTHFALSE') AS S003ACD
	    , TRIM(S001MNM) AS S001MNM
	    , TRIM(S001PTH) AS S001PTH
	    , S001SEQ
	    , TRIM(S001ICN) AS S001ICN
    FROM WEBDBLIB.MWS001M@ 
    LEFT JOIN (
		SELECT S003COR, S003ACD, S003MCD,S003HRC
			FROM WEBDBLIB.MWS003M@
			WHERE S003COR = I_COR
			AND (S003COR,S003ACD )
				= (SELECT S005COR,S005AGR  
					FROM WEBDBLIB.MWS005M@
					WHERE S005COR = I_COR
					AND S005UID = I_UID)
		) S003
		ON S001COR = S003COR
		AND S001MCD = S003MCD
	WHERE S001COR = I_COR
	AND S001UYN = 'Y'
	AND S001PTH = I_PTH
	;
	SET O_MSGCOD = '200';    
    OPEN CUR1;
END



